<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}BomPraPet{% endblock %}</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const tipoSelect = document.getElementById('tipo');
  const corSelect = document.getElementById('cor');
  const idadeSelect = document.getElementById('idade');
  const petList = document.getElementById('pet-list');

  const fetchPets = () => {
    const tipo = tipoSelect.value;
    const cor = corSelect.value;
    const idade = idadeSelect.value;

    fetch(`/filter_pets?tipo=${tipo}&cor=${cor}&idade=${idade}`)
      .then(response => response.json())
      .then(data => {
        petList.innerHTML = '';

        if (data.length === 0) {
          petList.innerHTML = `<div class="alert alert-info">Nenhum pet encontrado com esses filtros.</div>`;
          return;
        }

        data.forEach(pet => {
          const card = `
            <div class="col-md-4 mb-4">
              <div class="card h-100 shadow-sm">
                ${pet.imagem ? 
                  `<img src="${pet.imagem}" class="card-img-top" style="height:220px; object-fit:cover;" alt="${pet.nome}">` :
                  `<div class="bg-secondary text-white d-flex align-items-center justify-content-center" style="height:220px;"><small>Sem imagem</small></div>`}
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title mb-1">${pet.nome}</h5>
                  <div class="mb-2"><small class="text-muted">${pet.tipo || '—'} • ${pet.idade || 'idade desconhecida'}</small></div>
                  <p class="card-text text-truncate" style="max-height:3.6em; overflow:hidden;">${pet.descricao || 'Sem descrição'}</p>
                  <div class="mt-auto"><p class="mb-2"><strong>Contato:</strong> ${pet.contato}</p></div>
                </div>
              </div>
            </div>`;
          petList.insertAdjacentHTML('beforeend', card);
        });
      })
      .catch(err => console.error(err));
  };

  // aplica o filtro ao mudar qualquer campo
  [tipoSelect, corSelect, idadeSelect].forEach(el => {
    el.addEventListener('change', fetchPets);
  });
});
</script>

<body class="bg-[#f1d28b] min-h-screen font-sans">

  <!-- NAVBAR -->
  <nav class="flex justify-between items-center bg-[#49a3ff] px-6 py-2 shadow-md rounded-b-md">
    <div class="flex items-center space-x-2">
      <a href="{{ url_for('index') }}" class="flex items-center space-x-2">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="BomPraPet" class="h-10 w-auto">
        <span class="text-lg font-semibold text-black">BomPraPet</span>
      </a>
    </div>

    <div class="flex space-x-4 items-center">
      {% if current_user.is_authenticated %}
      <a href="{{ url_for('create') }}" method="POST">
        <button type="submit" class="text-white hover:underline">Adicionar Pet</button>
      </a>
      <a href="{{ url_for('perfil') }}" class="flex items-center space-x-2">
        <img src="{{ url_for('static', filename='perfil.png') }}" alt="Perfil" class="h-9 w-9 rounded-full">
      </a>
      <a href="{{ url_for('logout') }}" method="POST">
        <button type="submit" class="text-white hover:underline">Sair</button>
      </a>
      {% else %}
      <a href="{{ url_for('login') }}" class="text-white hover:underline">Entrar</a>
      <span class="text-white">|</span>
      <a href="{{ url_for('register') }}" class="text-white hover:underline">Cadastro</a>
      {% endif %}
    </div>
  </nav>

  <!-- CONTEÚDO PRINCIPAL -->
  <main class="container mx-auto p-6">
    {% block content %}{% endblock %}
  </main>

</body>
</html>

