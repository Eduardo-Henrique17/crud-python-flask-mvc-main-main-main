{% extends 'base.html' %}
{% block content %}

<div class="container mt-4">

  <h3 class="mb-3">Filtrar Pets</h3>

  <div class="row mb-4">
    <div class="col-md-3">
      <select id="tipo" class="form-select">
        <option value="todos">Todos os tipos</option>
        <option value="cachorro">Cachorro</option>
        <option value="gato">Gato</option>
        <option value="pássaro">Pássaro</option>
      </select>
    </div>

    <div class="col-md-3">
      <select id="cor" class="form-select">
        <option value="todas">Todas as cores</option>
        <option value="preto">Preto</option>
        <option value="branco">Branco</option>
        <option value="marrom">Marrom</option>
        <option value="cinza">Cinza</option>
      </select>
    </div>

    <div class="col-md-3">
      <select id="idade" class="form-select">
        <option value="todas">Todas as idades</option>
        <option value="filhote">Filhote</option>
        <option value="adulto">Adulto</option>
        <option value="idoso">Idoso</option>
      </select>
    </div>
  </div>

  <div class="row" id="pet-list">
    {% for item in items %}
      {% include 'partials/pet_card.html' %}
    {% endfor %}
  </div>

</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const tipoSelect = document.getElementById('tipo');
  const corSelect = document.getElementById('cor');
  const idadeSelect = document.getElementById('idade');
  const petList = document.getElementById('pet-list');

  const fetchPets = () => {
    const tipo = tipoSelect.value;
    const cor = corSelect.value;
    const idade = idadeSelect.value;

    petList.innerHTML = '<div class="text-center text-muted p-4">Carregando...</div>';

    fetch(`/filter_pets?tipo=${tipo}&cor=${cor}&idade=${idade}`)
      .then(response => response.json())
      .then(data => {
        petList.innerHTML = '';
        if (data.length === 0) {
          petList.innerHTML = `<div class="alert alert-info">Nenhum pet encontrado com esses filtros.</div>`;
          return;
        }

        data.forEach(pet => {
          const card = `
            <div class="col-md-4 mb-4">
              <div class="card h-100 shadow-sm">
                ${pet.imagem ? 
                  `<img src="${pet.imagem}" class="card-img-top" style="height:220px; object-fit:cover;" alt="${pet.nome}">` :
                  `<div class="bg-secondary text-white d-flex align-items-center justify-content-center" style="height:220px;"><small>Sem imagem</small></div>`}
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title mb-1">${pet.nome}</h5>
                  <div class="mb-2"><small class="text-muted">${pet.tipo || '—'} • ${pet.idade || 'idade desconhecida'}${pet.cor ? ' • ' + pet.cor : ''}</small></div>
                  <p class="card-text text-truncate" style="max-height:3.6em; overflow:hidden;">${pet.descricao || 'Sem descrição'}</p>
                  <div class="mt-auto"><p class="mb-2"><strong>Contato:</strong> ${pet.contato}</p></div>
                </div>
              </div>
            </div>`;
          petList.insertAdjacentHTML('beforeend', card);
        });
      })
      .catch(err => console.error(err));
  };

  [tipoSelect, corSelect, idadeSelect].forEach(el => el.addEventListener('change', fetchPets));
});
</script>

{% endblock %}
